{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { CollectionSlug, Config } from \"payload\";\nimport { Roles } from \"./collections/Roles\";\n\nexport const rbacPlugin =\n  () =>\n  (incomingConfig: Config): Config => {\n    const config = { ...incomingConfig };\n    config.collections = [...(incomingConfig.collections ?? [])];\n\n    config.collections.push(Roles);\n\n    const authCollection =\n      config.collections.find((c) => c.slug === config.admin?.user) ??\n      config.collections.find((c) => Boolean(c.auth));\n\n    if (!authCollection) {\n      throw new Error(\n        \"[@dexilion/payload-rbac] No auth-enabled collection found\" +\n          ' (e.g. \"users\").',\n      );\n    }\n\n    authCollection.fields = authCollection.fields || [];\n    authCollection.fields.push({\n      name: \"roles\",\n      type: \"relationship\",\n      relationTo: \"roles\" as CollectionSlug,\n      hasMany: true,\n      hidden: true,\n      admin: {\n        hidden: false,\n      },\n    });\n\n    return config;\n  };\n"],"names":["Roles","rbacPlugin","incomingConfig","config","collections","push","authCollection","find","c","slug","admin","user","Boolean","auth","Error","fields","name","type","relationTo","hasMany","hidden"],"mappings":"AACA,SAASA,KAAK,QAAQ,sBAAsB;AAE5C,OAAO,MAAMC,aACX,IACA,CAACC;QACC,MAAMC,SAAS;YAAE,GAAGD,cAAc;QAAC;QACnCC,OAAOC,WAAW,GAAG;eAAKF,eAAeE,WAAW,IAAI,EAAE;SAAE;QAE5DD,OAAOC,WAAW,CAACC,IAAI,CAACL;QAExB,MAAMM,iBACJH,OAAOC,WAAW,CAACG,IAAI,CAAC,CAACC,IAAMA,EAAEC,IAAI,KAAKN,OAAOO,KAAK,EAAEC,SACxDR,OAAOC,WAAW,CAACG,IAAI,CAAC,CAACC,IAAMI,QAAQJ,EAAEK,IAAI;QAE/C,IAAI,CAACP,gBAAgB;YACnB,MAAM,IAAIQ,MACR,8DACE;QAEN;QAEAR,eAAeS,MAAM,GAAGT,eAAeS,MAAM,IAAI,EAAE;QACnDT,eAAeS,MAAM,CAACV,IAAI,CAAC;YACzBW,MAAM;YACNC,MAAM;YACNC,YAAY;YACZC,SAAS;YACTC,QAAQ;YACRV,OAAO;gBACLU,QAAQ;YACV;QACF;QAEA,OAAOjB;IACT,EAAE"}